<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content=" Biometrics Unit, IITA">

<title>Seminar - UNLOCKING INSIGHTS: End-To-End Machine Learning(Supervised Machine Learning)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Seminar</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link active" href="./index.html" aria-current="page"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-to-machine-learning-ml" id="toc-introduction-to-machine-learning-ml" class="nav-link active" data-scroll-target="#introduction-to-machine-learning-ml"><span style="color: #2C6D26;"><strong>Introduction to Machine Learning (ML)</strong></span></a></li>
  <li><a href="#mlai-use-case-in-agriculture-ml" id="toc-mlai-use-case-in-agriculture-ml" class="nav-link" data-scroll-target="#mlai-use-case-in-agriculture-ml"><span style="color: #2C6D26;"><strong>ML/AI Use Case in Agriculture (ML)</strong></span></a></li>
  <li><a href="#introduction-to-machine-learning-ml-1" id="toc-introduction-to-machine-learning-ml-1" class="nav-link" data-scroll-target="#introduction-to-machine-learning-ml-1"><span style="color: #2C6D26;"><strong>Introduction to Machine Learning (ML)</strong></span></a></li>
  <li><a href="#ml-key-considerations" id="toc-ml-key-considerations" class="nav-link" data-scroll-target="#ml-key-considerations"><span style="color: #2C6D26;"><strong>ML: Key Considerations</strong></span></a></li>
  <li><a href="#steps-in-machine-learning" id="toc-steps-in-machine-learning" class="nav-link" data-scroll-target="#steps-in-machine-learning"><span style="color: #2C6D26;"><strong>Steps in Machine Learning</strong></span></a></li>
  <li><a href="#introduction-to-tidymodels-ml" id="toc-introduction-to-tidymodels-ml" class="nav-link" data-scroll-target="#introduction-to-tidymodels-ml"><span style="color: #2C6D26;"><strong>Introduction to Tidymodels (ML)</strong></span></a></li>
  <li><a href="#data" id="toc-data" class="nav-link" data-scroll-target="#data"><span style="color: #2C6D26;"><strong>Data</strong></span></a></li>
  <li><a href="#classification-task-ml" id="toc-classification-task-ml" class="nav-link" data-scroll-target="#classification-task-ml"><span style="color: #2C6D26;"><strong>Classification Task (ML)</strong></span></a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><b>UNLOCKING INSIGHTS:<br> <br>End-To-End Machine Learning(Supervised Machine Learning)</b><br></h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p><font color="#ff6600"><b> Biometrics Unit, IITA</b></font><br> </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="introduction-to-machine-learning-ml" class="level1">
<h1><span style="color: #2C6D26;"><strong>Introduction to Machine Learning (ML)</strong></span></h1>
<p>Artificial intelligence (<strong>AI</strong>) is a technology that equips machines with the ability to simulate human behaviour, specifically cognitive processes.</p>
<p>Machine learning (<strong>ML</strong>) is a branch of <strong>AI</strong> that uses data and algorithms to learn in the same way humans do, gradually improving its accuracy. Machine learning algorithms use historical data as input to predict new output values.</p>
<p><img src="images/ML Agric.png" width="50%"></p>
<p>Image credit: <em>GeoPard Agriculture</em></p>
</section>
<section id="mlai-use-case-in-agriculture-ml" class="level1">
<h1><span style="color: #2C6D26;"><strong>ML/AI Use Case in Agriculture (ML)</strong></span></h1>
<p><img src="images/Akilimo.png" width="50%"></p>
<p><strong>Akilimo</strong> (<a href="https://akilimo.org/)" class="uri">https://akilimo.org/)</a> combines ML with state-of-the-art crop models, geospatial statistics, and economic optimization algorithms to provide tailored recommendations that maximize net returns on investments within a user-defined budget.</p>
<p><img src="images/NuruAI.png" width="50%"></p>
<p><strong>NuruAI</strong> (<a href="https://plantvillage.psu.edu/))" class="uri">https://plantvillage.psu.edu/))</a> by IITA and Pennsylvania State University (USA) employs AI with ML to recognize symptoms of cassava brown streak disease, cassava mosaic disease, cassava green mite damage, and the healthy condition from images of cassava leaves.</p>
<p><img src="images/RiceAvice.png" width="50%"></p>
<p><strong>RiceAdvice</strong> (<a href="https://riceadvice.info)" class="uri">https://riceadvice.info)</a> a smartphone app developed by the Africa Rice Center (AfricaRice), employs ML as part of its modeling framework. It provides field-specific management guidelines for rice production systems in Africa. The guidelines are generated based on farmers’ answers to multiple-choice questions about crop management practices and market conditions.</p>
</section>
<section id="introduction-to-machine-learning-ml-1" class="level1">
<h1><span style="color: #2C6D26;"><strong>Introduction to Machine Learning (ML)</strong></span></h1>
<p><img src="images/machine_learning_meme.png" width="50%"></p>
<p>Source: <a href="https://xkcd.com/1838/" class="uri">https://xkcd.com/1838/</a></p>
<p><img src="images/Supervised Learning.png" width="60%"></p>
<p><strong>Supervised Learning</strong>: the goal is to learn a mapping from inputs to outputs, allowing the model to make predictions on new, unseen data. Common algorithms include linear regression, logistic regression, decision trees, support vector machines, random forest, etc.</p>
</section>
<section id="ml-key-considerations" class="level1">
<h1><span style="color: #2C6D26;"><strong>ML: Key Considerations</strong></span></h1>
<p>When working with machine learning, several key considerations should be taken into account to ensure quality model.</p>
<p><strong>Data Quality:</strong> The quality of the data used for training is crucial because the success of a machine learning model heavily depends on it. This includes ensuring that the data is accurate, complete, and representative of the problem domain.</p>
<p><strong>Sample Size:</strong> To have reliable model for prediction, the sample size has to be sufficiently large.</p>
<p><strong>Feature Engineering:</strong> This is the process of creating and transforming variables (features) from raw data to enhance the predictive power of ML models. These features can be numerical, categorical, etc. Knowing the data type and the unit of measurement of each feature is very important in performing feature engineering.</p>
<p><strong>Feature Selection:</strong> Identifying the right features (input variables) that contribute to the model’s performance is important. Irrelevant or redundant features can lead to overfitting and reduced model accuracy. Model Selection: Choosing the appropriate algorithm or model architecture based on the problem type (classification, regression, clustering, etc.) and the nature of the data is vital. Different models have different strengths and weaknesses.</p>
<p><strong>Overfitting and Underfitting:</strong> Balancing the model’s complexity is essential. Overfitting occurs when a model learns the training data too well, including noise, while underfitting happens when a model is too simple to capture the underlying patterns.</p>
<p><strong>Hyperparameter Tuning:</strong> Many machine learning models have hyperparameters that need to be set before training. Tuning these parameters can significantly impact model performance and often requires techniques like grid search or random search.</p>
<p><strong>Evaluation Metrics:</strong> Selecting appropriate metrics to evaluate model performance is crucial. Common metrics include accuracy, precision, recall, F1-score, and area under the ROC curve (AUC-ROC) for the classification task, R-squared, RMSE, and MAE for the regression task.</p>
<p><strong>Computing Power:</strong> This is very important because not machines (laptop or desktop) have the power to handle certain ML task. When the data is large, which is usually the case in a typical ML task, machines with high processing power are recommended.</p>
</section>
<section id="steps-in-machine-learning" class="level1">
<h1><span style="color: #2C6D26;"><strong>Steps in Machine Learning</strong></span></h1>
<p><strong>STEP 0 - Define the Problem and Collect/Gather the data</strong> that will be used to train the model</p>
<p><strong>STEP 1 - Data pre-processing:</strong> * Clean the dataset to handle missing values, incorrect data, and remove duplicates.</p>
<ul>
<li><p>Perform exploratory data analysis (EDA) to understand the patterns, trends, and relationships within the data</p></li>
<li><p>Divide the data into training and test sets Data transformation and normalization (training and test sets) to make it suitable for modeling.</p></li>
</ul>
<p><strong>STEP 2 - Train the Model:</strong> * Choose an ML model appropriate with the data (the target)</p>
<ul>
<li><p>Cross-validation: Divide the training dataset into “k” subsets or “folds”. The model training and validation process is repeated “k” times, with each of the k folds used exactly once as the validation data, and the remaining k-1 folds used as training data</p></li>
<li><p>Tune the model (some ML): based on the performance metrics, adjust the model parameters. Hyperparameter tuning can be done manually or through automated methods like grid search or random search.</p></li>
</ul>
</section>
<section id="introduction-to-tidymodels-ml" class="level1">
<h1><span style="color: #2C6D26;"><strong>Introduction to Tidymodels (ML)</strong></span></h1>
<p><img src="images/Tidymodels.png" width="80%"></p>
<p><a href="https://www.tidymodels.org/" class="uri">https://www.tidymodels.org/</a></p>
<p><img src="images/Tidymodels packages.png" width="100%"></p>
</section>
<section id="data" class="level1">
<h1><span style="color: #2C6D26;"><strong>Data</strong></span></h1>
<p>To dive into the tidymodels proper, let us look at the data. Let’s consider the Honey dataset (247,903 records). This is a dataset in the public domain (Kaggle)</p>
<p>The Objective here is to predict the variable <strong>purity of honey</strong> using the features described below.</p>
<ul>
<li><strong>Purity:</strong> Represents the purity of the honey sample, ranging from 0.01 to 1.00.</li>
<li><strong>CS (Color Score):</strong> Represents the color score of the honey sample, ranging from 1.0 to 10.0.</li>
<li><strong>Density:</strong> Represents the density of the honey sample in grams per cubic centimeter at 25?C, ranging from 1.21 to 1.86.</li>
<li><strong>WC (Water Content):</strong> Represents the water content in the honey sample, ranging from 12.0% to 25.0%.</li>
<li><strong>pH:</strong> Represents the pH level of the honey sample, ranging from 2.50 to 7.50.</li>
<li><strong>EC (Electrical Conductivity):</strong> Represents the electrical conductivity of the honey sample in milliSiemens per centimeter.</li>
<li><strong>F (Fructose Level):</strong> Represents the fructose level of the honey sample, ranging from 20 to 50.</li>
<li><strong>G (Glucose Level):</strong> Represents the glucose level of the honey sample, ranging from 20 to 45.</li>
<li><strong>Pollen_analysis:</strong> Represents the floral source of the honey sample.</li>
<li><strong>Price:</strong> The calculated price of the honey.</li>
</ul>
</section>
<section id="classification-task-ml" class="level1">
<h1><span style="color: #2C6D26;"><strong>Classification Task (ML)</strong></span></h1>
<p>In the regression task the response variable is quantitative. However, in several instances, the response variable is qualitative i.e.&nbsp;plant health status - healthy or not healthy, or disease severity status - mild, moderate, and severe, etc. Qualitative variables are referred to as categorical variables. The goal of classification is to predict the probability that an instance belongs to a particular class or not. However, the predictors can either be quantitative or qualitative variables.</p>
<p>In this part we go through the same procedure as the regression task. The major differences are the the specification of <code>mode</code> in the <code>recipe</code> function and the evaluation metrics. We are still going to use the random forest algorithm since it is both a classification and regression task.</p>
<p>Let’s use the apple.csv dataset with <strong>4,000</strong> observations. This dataset contains information about various attributes of a set of fruits, providing insights into their characteristics.</p>
<p>The dataset includes the following key features:</p>
<ul>
<li><strong>A_id:</strong> Unique identifier for each fruit</li>
<li><strong>Size:</strong> Size of the fruit</li>
<li><strong>Weight:</strong> Weight of the fruit</li>
<li><strong>Sweetness:</strong> Degree of sweetness of the fruit</li>
<li><strong>Crunchiness:</strong> Texture indicating the crunchiness of the fruit</li>
<li><strong>Juiciness:</strong> Level of juiciness of the fruit</li>
<li><strong>Ripeness:</strong> Stage of ripeness of the fruit</li>
<li><strong>Acidity:</strong> Acidity level of the fruit</li>
<li><strong>Quality:</strong> Overall quality of the fruit</li>
</ul>
<p>The objective of this exercise is to build a model to predict the quality rating of the apple fruits based on their features.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>